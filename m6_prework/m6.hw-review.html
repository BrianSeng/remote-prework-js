<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Meeting 6 - Blog Tab 3 HW Review</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        li.active {
            font-weight: bolder;
            text-decoration: underline;
        }
        .reply
        {
            margin-bottom:20px;
        }
        .comment .comment
        {
            margin-left: 40px;
        }
    </style>

</head>
<body>
    <nav class="navbar navbar-inverse">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a href="https://sabio.la/"><img class="img-responsive img-circle navbar-brand" src="https://course_report_production.s3.amazonaws.com/rich/rich_files/rich_files/93/s200/sabio-la-logo.png"></a>
				<a class="navbar-brand" href="#">Sabio Full Stack Training</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="..\m3_prework\m3.homework.html">1) Post Input</a></li>
                    <li><a href="..\m5_prework\m5.hw-review.html">2) Show Hidden Comments</a></li>
                    <li  class="active"><a href="..\m6_prework\m6.hw-review.html">3) Add Comments/Replies</a></li>
                    <li><a href="GenerateFromJSObject.html">4) Generate from JS Object</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>

    <div class="container instructions">

        <a class="btn btn-primary cmdInstructions" role="button" data-toggle="collapse"
           href="#instructions" aria-expanded="false"
           aria-controls="instructions">
            Show/Hide Instructions
        </a>

        <div id="instructions" class="collapse">

            <div class="well instructions ">
                <div>The Comments for this blog page are in the source of the page.</div>
                <div>
                    <span class="label label-success label-as-badge">1</span>
                    <span>
                        Pick up where you left off in the last step. Feel free to copy that entire file and start a new one using that source code.
                    </span>
                </div>

                <div>
                    <span class="label label-success label-as-badge">2</span>
                    <span>
                        Add a button or "button link" that when clicked, will reveal a form that can be used to capture the
                        data from the user that will be used as a "Comment" to the blog.
                    </span>

                </div>

                <div>
                    <span class="label label-success label-as-badge">3</span>
                    <span>
                        Add a button or "button link" to the form revealed in step 2. When you click on this button take the content
                        from the form and add it to the DOM in the "shape" (HTML structure) of a comment.
                    </span>
                </div>
            </div>


        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="blog-post bg-white">
                <h2 class="blog-post-title">The Best Blog Post Title</h2>
                <p class="blog-post-meta">by <a href="#">gregorio@sabio.la</a></p>

                <div id="lipsum">
                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed eu sapien scelerisque, dictum nisi vehicula, tincidunt nunc. Quisque ut lacinia ipsum, ut fermentum nisl. Donec et volutpat lectus. Cras tincidunt imperdiet tincidunt. Mauris consequat vestibulum euismod. Phasellus velit mauris, laoreet ut lacus sagittis, ultricies dapibus arcu. Interdum et malesuada fames ac ante ipsum primis in faucibus. Donec nulla risus, imperdiet ut urna pulvinar, cursus dignissim turpis. Curabitur cursus vehicula facilisis. Donec odio enim, blandit id cursus vel, pretium et lectus. Curabitur id eros rhoncus, bibendum sem et, ultricies magna. Suspendisse placerat semper pellentesque. Aenean varius molestie elit, at elementum neque rutrum luctus. Mauris at nisi in neque aliquam pulvinar. Aenean eu aliquet nisl.
                    </p>

                </div>
            </div>

        </div>
        <div class="row commentsContainer bg-white">
            <div class="comments">
                <h2 class="title">There are 6 comments</h2>

                <!-- comment start -->
                <div class="comment mediaclearfix">
                    <div class="comment-avatar media-left">
                        <img src="http://placehold.it/50x50" alt="avatar">
                    </div>
                    <div class="comment-content media-body">
                        <h3 class="media-heading">Comment title</h3>
                        <div class="comment-meta">By <a href="#">admin</a> | Today, 12:31</div>
                        <div class="comment-body clearfix">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo </p>
                            <a href="#" class="btn btn-info more  reply" >Reply</a>
                        </div>
                    </div>

                    <!-- comment start -->
                    <div class="comment mediaclearfix">
                        <div class="comment-avatar media-left">
                            <img src="http://placehold.it/50x50" alt="avatar">
                        </div>
                        <div class="comment-content media-body clearfix">
                            <h3 class="media-heading">Comment title</h3>
                            <div class="comment-meta">By <a href="#">admin</a> | Today, 12:31</div>
                            <div class="comment-body">
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo </p>
                                <a href="#" class="btn btn-info more  reply" >Reply</a>
                            </div>
                        </div>
                    </div>
                    <!-- comment end -->

                </div>
                <!-- comment end -->
                <!-- comment start -->
                <div class="comment mediaclearfix">
                    <div class="comment-avatar media-left">
                        <img src="http://placehold.it/50x50" alt="avatar">
                    </div>
                    <div class="comment-content media-body clearfix">
                        <h3 class="media-heading">Comment title</h3>
                        <div class="comment-meta">By <a href="#">admin</a> | Today, 12:31</div>
                        <div class="comment-body">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo </p>
                            <a href="#" class="btn btn-info more  reply" >Reply</a>
                        </div>
                    </div>
                </div>
                <!-- comment end -->
                <!-- comment start -->
                <div class="comment mediaclearfix">
                    <div class="comment-avatar media-left">
                        <img src="http://placehold.it/50x50" alt="avatar">
                    </div>
                    <div class="comment-content media-body clearfix">
                        <h3 class="media-heading">Comment title</h3>
                        <div class="comment-meta">By <a href="#">admin</a> | Today, 12:31</div>
                        <div class="comment-body">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo </p>
                            <a href="#" class="btn btn-info more  reply" >Reply</a>
                        </div>
                    </div>
                </div>
                <!-- comment end -->
                <!-- comment start -->
                <div class="comment mediaclearfix">
                    <div class="comment-avatar media-left">
                        <img src="http://placehold.it/50x50" alt="avatar">
                    </div>
                    <div class="comment-content media-body clearfix">
                        <h3 class="media-heading">Comment title</h3>
                        <div class="comment-meta">By <a href="#">admin</a> | Today, 12:31</div>
                        <div class="comment-body">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo </p>
                            <a href="#" class="btn btn-info more  reply" >Reply</a>
                        </div>
                    </div>
                </div>
                <!-- comment end -->
                <!-- comment start -->
                <div class="comment mediaclearfix">
                    <div class="comment-avatar media-left">
                        <img src="http://placehold.it/50x50" alt="avatar">
                    </div>
                    <div class="comment-content media-body clearfix">
                        <h3 class="media-heading">Comment title</h3>
                        <div class="comment-meta">By <a href="#">admin</a> | Today, 12:31</div>
                        <div class="comment-body">
                            <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo </p>
                            <a href="#" class="btn btn-info more  reply" >Reply</a>
                        </div>
                    </div>
                </div>
                <!-- comment end -->
            </div>

        </div>
        <hr />
        <div class="row newCommentForm bg-white">
            <div class="comments-form col-md-12">
                <h2 class="title">Add your comment</h2>
                <div class="col-md-8" id="formContainer">
                    <form>
                        <div class="form-group">
                            <label for="title">Comment Title</label>
                            <input type="text" class="form-control cmt-title" placeholder="Enter your post's title here...">
                        </div>
                        <div class="form-group">
                            <label for="postEmail">Email</label>
                            <input type="email" class="form-control cmt-email" placeholder="Enter your email here...">
                        </div>
                        <div class="form-group">
                            <label for="postContent">Your Comment</label>
                            <textarea rows="5" cols="76" class="form-control cmt-body"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary" id="addComment"><strong>Add Comment</strong></button>
                    </form>
                </div>
            </div>

        </div>
    </div><!-- /.container -->
    <footer class="text-center">
        <hr />
        This is the footer of the document. Here to take up space.
    </footer>

    <!-- ====================================================================================== -->
	<!-- **MUST GO W/ A VERSION OF jQuery above 1.9 and below 3 for Bootstrap JS file to work** -->
	<script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <script src="http://sabioapi2.azurewebsites.net/scripts/sabio.js"></script>


    <script type="text/javascript">
		/* a switch that we use to check which form to use readValues() on, "null" means we're going to use our bottom form
		 * if it is not null (i.e. an html node in our case), that means we're working with our modal form and have a target 
		 * to append to */
        sabio.page.activeReplyLink = null;
        
		//===** STARTUP **===
        sabio.page.startUp = function ()
        {
        	$("#addComment, .cmdAddComment").on("click", sabio.page.handlers.btnAddComment);

        	/* notice this .on() function selecting the ".comments" div takes 3 parameters (event, class filter, function)
			 * this wiring for the click event will filter and only listen for any ".reply" class inside of the ".comments" div 
			 * if we selected $(".reply") instead of $(".comments"), the reply links of any new comments added to the DOM won't work */
        	$(".comments").on("click", ".reply", sabio.page.handlers.btnReplyLink);
            
            $("#myModal").on("hidden.bs.modal", sabio.page.handlers.modalClosing);
        }

		//===** EVENT HANDLERS **===
        sabio.page.handlers.btnAddComment = function (event)
        {
        	event.preventDefault();

        	var comment = sabio.utilities.readValues();

        	sabio.utilities.setValues(comment);

            sabio.utilities.clearForm();
            //sabio.page.activeReplyLink = null;
        }

        sabio.page.handlers.btnReplyLink = function (event) 
        {
        	event.preventDefault();

        	//on the reply link press, we are both opening the form and capturing the html element that caused the event with "this", in this case being the <a> tag of the reply link
        	sabio.page.activeReplyLink = this; 

            sabio.utilities.openReplyForm();
        }

        sabio.page.handlers.modalClosing = function ()
        {
            sabio.page.activeReplyLink = null;
        }

		//===** UTILITY FUNCTIONS **===
        sabio.utilities.readValues = function ()
        {
        	var activeForm = sabio.utilities.getActiveForm();

            var comment =
            {
            	title: $(".cmt-title", activeForm).val()
				, email: $(".cmt-email", activeForm).val()
				, body: $(".cmt-body", activeForm).val()
            };

            return comment;
        }

        sabio.utilities.setValues = function (comment)
        {
        	var newCommentHtml = sabio.utilities.getCommentHtml(comment);

        	sabio.utilities.appendNewComment(newCommentHtml);

			//finding how many divs w/ class comment
            var numberOfComments = $(".comment").length; 

        	//looks for an h2 with the class title inside of the .comments div
            $(".comments h2.title").text("There are " + numberOfComments + " comments");
        }

        sabio.utilities.openReplyForm = function ()
        {
            $("#myModal").modal("show");
        };

		sabio.utilities.clearForm = function ()
        {
        	var activeForm = $("#formContainer");

            if (sabio.page.activeReplyLink != null)
            {
                activeForm = $(".modal-body");
            };
            activeForm.find("form")[0].reset();
		}

		sabio.utilities.getActiveForm = function()
		{
			/* depending on the state of our activeReplyLink switch, we figure out 
			 * which form was used to collect input and return it as a jQuery object */
            if(sabio.page.activeReplyLink != null)
            {
                return $(".modal-body");
            }
            else
            {
            	return $("#formContainer");
            }
		}

        sabio.utilities.loadTemplate = function ()
        {
        	/* the first jQuery wrapper "$("#template")" selects our comment template by id from below 
			 * and uses .html() on it to read the raw html, thus rendering it as a DOM ready object 
			 * (we could append this raw html on the pg, but we want to change it first)
			 * the second selector wrapped around it now selects the raw html node and turns it into 
			 * a jQuery object that you're now capable of running functions/methods on */
            return $($("#template").html());
        }

        sabio.utilities.getCommentHtml = function (comment)
        {
        	var commentTemplate = sabio.utilities.loadTemplate();

			$(".media-heading", commentTemplate).text(comment.title);

        	/* we are finding the media-heading in the template and changing the text
             * SAME RESULT AS ABOVE, BUT A DIFF WAY OF DOING IT:
             * --> template.find(".comment-heading").text(comment.title); */
            
            $(".comment-meta a", commentTemplate).text(comment.email);
            $(".comment-meta a", commentTemplate).prop("href", "mailto:" + comment.email);
            $(".comment-body p", commentTemplate).text(comment.body);
        }

        sabio.utilities.appendNewComment = function (newComment)
        {
			//depending on the state of our activeReplyLink switch, we figure out which container to append to
			if (sabio.page.activeReplyLink == null)
            {
                $(".comments").append(newComment);
            }
            else 
            {
            	//finds and captures the closest parent of the selected <a> tag w/ the comment class
            	var containerComment = $(sabio.page.activeReplyLink).closest(".comment"); 

            	$(containerComment).append(newComment);

                $("#myModal").modal("hide");
            }
        }

    </script>

	<!--==========================================================================-->
	<!--****************    START MODAL HTML (in hidden state)    ****************-->
	<!--==========================================================================-->
    <div class="modal fade" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" 
							class="close" 
							data-dismiss="modal">
						<span aria-hidden="true">&times;</span>
					</button>
                    <h3 class="modal-title">Add Your Reply</h3>
                </div>
                <div class="modal-body">
                    <div class="comments-form">
                        <div id="formContainer">
                            <form>
                                <div class="form-group">
                                    <label class="modal-label" for="title">Comment Title</label>
                                    <input type="text" 
										   class="form-control cmt-title" 
										   placeholder="Enter your post's title here...">
                                </div>
                                <div class="form-group">
                                    <label class="modal-label" for="postEmail">Email</label>
                                    <input type="email" 
										   class="form-control cmt-email" 
										   placeholder="Enter your email here...">
                                </div>
                                <div class="form-group">
                                    <label class="modal-label" for="postContent">Your Comment</label>
                                    <textarea rows="5" 
											  cols="76" 
											  class="form-control cmt-body"></textarea>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" 
							class="btn btn-default" 
							data-dismiss="modal">
						Close
					</button>
                    <input type="submit" 
						   value="Submit Reply" 
						   class="btn btn-success cmdAddComment"
                           data-formid="#comment-form-reply">
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>
	<!--========================================================================-->
	<!--****************    END MODAL HTML (in hidden state)    ****************-->
	<!--========================================================================-->


	<!--=================================================================================================-->
	<!-- THE BELOW <script> IS A COMMENT TEMPLATE THAT WILL FORMAT USER INPUT FOR INSERTION INTO THE DOM -->
	<!--=================================================================================================-->
    <script type="text/html" id="template">
        <div class="comment mediaclearfix">
            <div class="comment-avatar media-left">
                <img src="http://placehold.it/50x50" alt="avatar">
            </div>
            <div class="comment-content media-body clearfix">
                <h3 class="media-heading">Comment title</h3>
                <div class="comment-meta">By <a href="#">admin</a> | Today, 12:31</div>
                <div class="comment-body">
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo </p>
                    <a href="#" class="btn btn-info more  reply" >Reply</a>
                </div>
            </div>
        </div>
    </script>

</body>



</html>
